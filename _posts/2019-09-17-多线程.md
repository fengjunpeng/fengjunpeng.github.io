---
layout: post
title:  java 多线程
subtitle:   多线程
date:   2019-09-10
author: fengjp
catalog:    true
tags:
    - java
---

#   多线程

##  一、进程和线程

### 1、进程

进程是资源分配的基本单位

### 2、线程

线程是 CPU 调度的基本单位

区别

一个进程可以有多个线程，每个线程之间会相互影响竞争CPU的资源，进程之间不会相互影响。线程开销小，不利于管理；进程开销大，便于管理维护。

##  CAS操作

简单来说就是 compare and swap ， CAS 包含三个操作数，内存位置 V ，原值 A ，新值 B 。如果内存位置的值与预计的原值匹配，则更新 A 为 B ，否则不做任何处理。

- 通常来说，CAS 用于同步的时候，如果内存位置 V 处的值没有同时发生变化，则说明 CAS 操作成功。

### java 中的 CAS 操作原理

java 通过调用 JNI （java 本地调用）代码实现的。利用 Unsafe 的底层

好处：通过 CAS 可以保证一个变量的原子性。

compareAndSwapInt

### CAS 的缺点

1、遇到 ABA 的问题，变量从 A 变为 B ，后又变为 A 的情况。可以使用版本号解决。

2、循环开销大。当一个变量 CAS 操作失败，然后循环重试时，会消耗大量 CPU 资源。

3、CAS 不能保证多个变量的原子性。可以将多个变量合并成一个共享变量。
