---
layout: post
title:  垃圾回收
subtitle:   垃圾回收
date:   2019-09-10
author: fengjp
catalog:    true
tags:
    - java
---

## 垃圾回收

### 判断一个对象是否能被回收

#### 引用计数算法

为对象添加一个 __引用计数器__ ，当对象增加一个引用时计数器加 1，引用失效时计数器减 1 ，引用计数器为 0 时对象可回收。

当两个对象出现循环引用时，此时引用计数器永远不为 1 ，导致对象无法回收。

- 优点：执行效率高

- 缺点：无法检测出循环引用，引起内存泄露

#### 可达性分析算法

判断对象的引用链是否可达来决定对象是否可以被回收

从 GC Root 为起始点进行搜索，可达的对象都是存活的，不可达的对象可被回收， GC Root 一般包含：

1、java虚拟机栈的局部变量表引用的对象

2、本地方法栈 JNI （ Native 方法）中引用的对象

3、方法区的静态属性引用的对象

4、方法区常量引用的对象

5、活跃线程的引用的对象

#### 方法区的回收

方法区主要存放永久代对象，而永久代对象的回收效率较低。

主要是对类的卸载和常量池的回收。

为避免 OOM ，在大量使用反射和动态代理的场景都需要虚拟机具备类卸载功能

类卸载条件的条件很多，需要满足一下三个，并且满足了条件也不一定卸载：

- 该类的所有实例都已经被回收，堆中不存在该类的任何实例

- 加载该类的 ClassLoader 已经被回收

- 该类对应的 Class 对象没有在任何地方被引用，也就无法在任何地方通过反射访问该类方法

